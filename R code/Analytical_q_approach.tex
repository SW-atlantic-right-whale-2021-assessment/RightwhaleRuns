% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
  \usepackage{amssymb}
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Untitled},
  pdfauthor={Grant Adams},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Untitled}
\author{Grant Adams}
\date{5/21/2021}

\begin{document}
\maketitle

\[
LL = 0.5 * (\textbf{I}-log(q))^T\Sigma^{-1}(\textbf{I}-log(q))
\] \[
\textbf{I} = \textbf{Index}/\hat{\textbf{N}}
\] \$\$ LL = 0.5 *

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\^{}T

\begin{pmatrix}
\sigma_1^2 & \rho\sigma_1\sigma_2\\
\rho\sigma_1\sigma_2 & \sigma_2^2
\end{pmatrix}

\^{}\{-1\}

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\[
Invert
\] LL = 0.5 * \frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\^{}T

\begin{pmatrix}
\sigma_2^2 & -\rho\sigma_1\sigma_2\\
-\rho\sigma_1\sigma_2 & \sigma_1^2
\end{pmatrix}

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\[
Multiply out
\] LL = 0.5 * \frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\^{}T

\begin{pmatrix}
\sigma_2^2(I_1-log(q)) -\rho\sigma_1\sigma_2(I_2 -log(q))\\
-\rho\sigma_1\sigma_2(I_1-log(q)) + \sigma_1^2(I_2 -log(q))
\end{pmatrix}

\[
\] LL = 0.5 * \frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
I_1-log(q)\\
I_2 -log(q)
\end{pmatrix}

\^{}T

\begin{pmatrix}
\sigma_2^2(I_1-log(q)) -\rho\sigma_1\sigma_2(I_2 -log(q))\\
-\rho\sigma_1\sigma_2(I_1-log(q)) + \sigma_1^2(I_2 -log(q))
\end{pmatrix}

\$\$

\[LL = \dfrac{{\sigma}_1^2\left(I_2-log(q)\right)^2+
-2{\varphi}{\sigma}_1{\sigma}_2\left(I_1-log(q)\right)\left(I_2-log(q)\right)
+{\sigma}_2^2\left(I_1-log(q)\right)^2}
{2\left(1-{\varphi}^2\right){\sigma}_1^2{\sigma}_2^2}
\]

Take derivative
\[\dfrac{dLL}{dq}=-\dfrac{\left({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2\right)log(q)-I_1{\sigma}_2^2+\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2-I_2{\sigma}_1^2}{\left({\varphi}^2-1\right){\sigma}_1^2{\sigma}_2^2x} 
\] Set to zero and solve for q
\[0=-\dfrac{\left({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2\right)log(q)-I_1{\sigma}_2^2+\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2-I_2{\sigma}_1^2}{\left({\varphi}^2-1\right){\sigma}_1^2{\sigma}_2^2x} 
\]

\[0=\left({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2\right)log(q)-I_1{\sigma}_2^2+\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2-I_2{\sigma}_1^2
\]

\[-\left({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2\right)log(q)=-I_1{\sigma}_2^2+\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2-I_2{\sigma}_1^2
\]

\[log(q)=\frac{-I_1{\sigma}_2^2+\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2-I_2{\sigma}_1^2}
{-({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2)}
\]

\[q=exp\left(\frac{I_1{\sigma}_2^2-\left(I_2+I_1\right){\varphi}{\sigma}_1{\sigma}_2+I_2{\sigma}_1^2}
{({\sigma}_2^2-2{\varphi}{\sigma}_1{\sigma}_2+{\sigma}_1^2)}\right)
\]

\[
\Sigma^{-1}=
\frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}
\begin{pmatrix}
\sigma_2^2 & -\rho\sigma_1\sigma_2\\
-\rho\sigma_1\sigma_2 & \sigma_1^2
\end{pmatrix}
\] Numerator (sum hessian times index) \$\$ \Sigma\^{}\{-1\}\textbf{I} =
\frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
\sigma_2^2 I_1  -\rho\sigma_1\sigma_2 I_2 \\
-\rho\sigma_1\sigma_2 I_1 + \sigma_1^2 I_2
\end{pmatrix}

\$\$

\$\$ \sum \left( \frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
\sigma_2^2 I_1  -\rho\sigma_1\sigma_2 I_2 \\
-\rho\sigma_1\sigma_2 I_1 + \sigma_1^2 I_2
\end{pmatrix}

\right) =

\frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)} \sum 

\begin{pmatrix}
\sigma_2^2 I_1  -\rho\sigma_1\sigma_2 I_2 \\
-\rho\sigma_1\sigma_2 I_1 + \sigma_1^2 I_2
\end{pmatrix}

=

\frac{\sigma_2^2 I_1
-\rho\sigma_1\sigma_2 (I_1 +I_2)+ \sigma_1^2 I_2}

\{\sigma\_1\^{}2 \sigma\_2\^{}2 (1-\rho\^{}2)\}\\
\$\$

Denominator (sum hessian) \$\$ \sum
\frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}

\begin{pmatrix}
\sigma_2^2 & -\rho\sigma_1\sigma_2\\
-\rho\sigma_1\sigma_2 & \sigma_1^2
\end{pmatrix}

=

\frac{1}{\sigma_1^2 \sigma_2^2 (1-\rho^2)}
\sum
\begin{pmatrix}
\sigma_2^2 & -\rho\sigma_1\sigma_2\\
-\rho\sigma_1\sigma_2 & \sigma_1^2
\end{pmatrix}

=

\frac{\sigma_2^2 
-2\rho\sigma_1\sigma_2+ \sigma_1^2 }

\{\sigma\_1\^{}2 \sigma\_2\^{}2 (1-\rho\^{}2)\}\\
\$\$

\$\$ \frac{\sum{\Sigma^{-1}\textbf{I}}}{\sum{\Sigma^{-1}}}=
\frac{\frac{\sigma_2^2 I_1
-\rho\sigma_1\sigma_2 (I_1 +I_2)+ \sigma_1^2 I_2}
{\sigma_1^2 \sigma_2^2 (1-\rho^2)}  }

\{\frac{\sigma_2^2 
-2\rho\sigma_1\sigma_2+ \sigma_1^2 } \{\sigma\_1\^{}2 \sigma\_2\^{}2
(1-\rho\^{}2)\} \} = \frac{\sigma_2^2 I_1
-\rho\sigma_1\sigma_2 (I_1 +I_2)+ \sigma_1^2 I_2  }

\{\sigma\_2\^{}2 -2\rho\sigma\_1\sigma\_2+ \sigma\_1\^{}2 \} = log(q)

\$\$

\hypertarget{sim-analytical-q}{%
\section{Sim analytical q}\label{sim-analytical-q}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(MASS)}
\NormalTok{q }\OtherTok{\textless{}{-}} \FloatTok{0.5}
\NormalTok{Nvec }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{200}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{4}\NormalTok{)}
\NormalTok{varcov }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{,}\FloatTok{0.1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}
                   \FloatTok{0.1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\FloatTok{0.1}\NormalTok{,}\DecValTok{0}\NormalTok{,}
                   \DecValTok{0}\NormalTok{,}\FloatTok{0.1}\NormalTok{,}\FloatTok{0.2}\NormalTok{,}\FloatTok{0.1}\NormalTok{,}
                   \DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\FloatTok{0.1}\NormalTok{,}\FloatTok{0.2}\NormalTok{), }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{hess }\OtherTok{\textless{}{-}} \FunctionTok{solve}\NormalTok{(varcov)}
\NormalTok{simddata }\OtherTok{\textless{}{-}} \FunctionTok{exp}\NormalTok{(}\FunctionTok{mvrnorm}\NormalTok{(}\DecValTok{10000}\NormalTok{, }\AttributeTok{mu =} \FunctionTok{log}\NormalTok{(Nvec }\SpecialCharTok{*}\NormalTok{ q) }\SpecialCharTok{{-}} \FunctionTok{diag}\NormalTok{(varcov)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{, }\AttributeTok{Sigma =}\NormalTok{ varcov))}

\NormalTok{q\_est }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{apply}\NormalTok{(simddata,}\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{exp}\NormalTok{(}\FunctionTok{sum}\NormalTok{((hess) }\SpecialCharTok{\%*\%} \FunctionTok{log}\NormalTok{(x}\SpecialCharTok{/}\NormalTok{Nvec))}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{sum}\NormalTok{(hess)))))}
\FunctionTok{mean}\NormalTok{(q\_est)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4736292
\end{verbatim}

\end{document}
